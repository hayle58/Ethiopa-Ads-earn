<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethiopia Ads Earn</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; margin: 0; padding: 0; text-align: center; }
        .card { background: white; margin: 15px; padding: 20px; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .btn { background-color: #1a73e8; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 16px; width: 100%; margin-top: 10px; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #ddd; }
        .nav-item { cursor: pointer; color: #555; font-size: 14px; }
        .nav-item.active { color: #1a73e8; font-weight: bold; }
        #ref-link { background: #eee; padding: 15px; border-radius: 10px; word-break: break-all; margin-top: 10px; font-weight: bold; color: #1a73e8; }
    </style>
</head>
<body>

    <div id="tab-home" class="tab-content active">
        <div class="card">
            <h2>እንኳን ደህና መጡ!</h2>
            <p>የአሁኑ ባላንስዎ፦ <span id="balance" style="font-size: 24px; color: green; font-weight: bold;">0.00</span> ETB</p>
            <button class="btn" onclick="alert('ማስታወቂያ በአሁኑ ሰዓት የለም!')">ማስታወቂያ እይ</button>
        </div>
    </div>

    <div id="tab-invite" class="tab-content">
        <div class="card">
            <h3>ጓደኞችን ይጋብዙ</h3>
            <p>ለእያንዳንዱ የተጋበዘ ሰው 1.00 ETB ያገኛሉ።</p>
            <div id="ref-link">ሊንኩ እየተዘጋጀ ነው...</div>
            <button class="btn" onclick="copyRef()">ሊንኩን ኮፒ አድርግ</button>
        </div>
    </div>

    <div id="tab-wallet" class="tab-content">
        <div class="card">
            <h3>ብር ማውጫ</h3>
            <select id="w-method" class="btn" style="background: #fff; color: #333; border: 1px solid #ccc;">
                <option value="telebirr">Telebirr (30-50 ETB)</option>
                <option value="cbe">CBE Birr (150-200 ETB)</option>
            </select>
            <input type="text" id="w-name" placeholder="ሙሉ ስም" style="width:90%; padding:10px; margin-top:10px; border-radius:5px; border:1px solid #ddd;">
            <input type="number" id="w-phone" placeholder="ስልክ ቁጥር" style="width:90%; padding:10px; margin-top:10px; border-radius:5px; border:1px solid #ddd;">
            <input type="number" id="w-amount" placeholder="የብር መጠን" style="width:90%; padding:10px; margin-top:10px; border-radius:5px; border:1px solid #ddd;">
            <button class="btn" onclick="handleWithdraw()">ብር አውጣ (Withdraw)</button>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="switchTab('tab-home', this)">መነሻ</div>
        <div class="nav-item" onclick="switchTab('tab-invite', this)">ጋብዝ</div>
        <div class="nav-item" onclick="switchTab('tab-wallet', this)">ዋሌት</div>
    </div>

<script>
    // 1. Telegram & User Info
    const tg = window.Telegram.WebApp;
    tg.expand();
    const user_id = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "Unknown_User";
    const bot_username = "ethio_ads_58_bot";

    // 2. Firebase Configuration (ያንተ መረጃ)
    const firebaseConfig = {
        apiKey: "AIzaSyCg7-ixJaGiJlpi6qav1dTQUmr3K7Ccrpo",
        authDomain: "ethiopia-ads-earn.firebaseapp.com",
        databaseURL: "https://ethiopia-ads-earn-default-rtdb.firebaseio.com",
        projectId: "ethiopia-ads-earn",
        storageBucket: "ethiopia-ads-earn.firebasestorage.app",
        messagingSenderId: "428629596077",
        appId: "1:428629596077:web:67e7227814bd60cc413324"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // 3. ሪፈራል ሊንክ መፍጠሪያ
    const myInviteLink = `https://t.me/${bot_username}?start=${user_id}`;
    document.getElementById('ref-link').innerText = myInviteLink;

    // 4. የተጠቃሚውን ባላንስ ከFirebase ማምጣት
    database.ref('users/' + user_id).on('value', (snapshot) => {
        const data = snapshot.val();
        document.getElementById('balance').innerText = (data && data.balance) ? data.balance.toFixed(2) : "0.00";
    });

    // 5. ተግባራት (Functions)
    function switchTab(tabId, el) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        el.classList.add('active');
    }

    function copyRef() {
        const link = document.getElementById('ref-link').innerText;
        const tempInput = document.createElement("input");
        document.body.appendChild(tempInput);
        tempInput.value = link;
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);
        alert("የመጋበዣ ሊንክዎ ኮፒ ተደርጓል!");
    }

    function handleWithdraw() {
        const name = document.getElementById('w-name').value;
        const phone = document.getElementById('w-phone').value;
        const amount = document.getElementById('w-amount').value;
        
        if(!name || !phone || !amount) {
            alert("እባክዎ ሁሉንም መረጃ በትክክል ይሙሉ!");
            return;
        }

        database.ref('withdraw_requests').push({
            userId: user_id,
            name: name,
            phone: phone,
            amount: amount,
            time: Date.now()
        }).then(() => {
            alert("ጥያቄዎ ተልኳል! በአጭር ጊዜ ውስጥ ይከፈልዎታል።");
        });
    }
</script>
</body>
</html>
