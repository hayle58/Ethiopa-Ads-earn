<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - E-lab ADS</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --sidebar-bg: #f8f9fa; --active-blue: #0d6efd; --text-dark: #333; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; background-color: #f0f2f5; color: var(--text-dark); height: 100vh; overflow: hidden; }

        /* Sidebar Styling */
        .sidebar { width: 240px; background: var(--sidebar-bg); height: 100vh; border-right: 1px solid #ddd; padding-top: 20px; flex-shrink: 0; }
        .sidebar-brand { padding: 0 20px 20px; font-weight: bold; font-size: 20px; display: flex; align-items: center; }
        .sidebar-brand i { margin-right: 10px; color: var(--active-blue); }
        .nav-link { padding: 12px 25px; display: flex; align-items: center; cursor: pointer; color: #555; text-decoration: none; font-size: 15px; transition: 0.3s; }
        .nav-link i { margin-right: 15px; width: 20px; }
        .nav-link:hover { background: #e9ecef; }
        .nav-link.active { background: #e7f1ff; color: var(--active-blue); border-right: 4px solid var(--active-blue); font-weight: bold; }

        /* Main Content */
        .main-content { flex-grow: 1; padding: 30px; overflow-y: auto; }
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .dashboard-header { margin-bottom: 25px; font-size: 22px; font-weight: 600; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; display: flex; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .stat-icon { width: 55px; height: 55px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; margin-right: 15px; }
        .stat-info h4 { margin: 0; font-size: 14px; color: #777; font-weight: normal; }
        .stat-info div { font-size: 24px; font-weight: bold; margin-top: 5px; }

        .bg-blue { background: #4e73df; } .bg-green { background: #1cc88a; } .bg-orange { background: #f6c23e; } .bg-purple { background: #6f42c1; }

        /* Table Styling */
        .list-container { background: white; margin-top: 20px; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; padding: 12px; border-bottom: 2px solid #eee; background: #fafafa; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; }

        /* Forms */
        .form-group { margin-bottom: 15px; }
        input, textarea, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-top: 5px; }
        .btn { background: var(--active-blue); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-brand"><i class="fas fa-shield-alt"></i> Admin Panel</div>
        <div class="nav-link active" onclick="showSection('dashboard', this)"><i class="fas fa-th-large"></i> Dashboard</div>
        <div class="nav-link" onclick="showSection('users', this)"><i class="fas fa-users"></i> Users</div>
        <div class="nav-link" onclick="showSection('withdrawals', this)"><i class="fas fa-wallet"></i> Pending Withdrawals</div>
        <div class="nav-link" onclick="showSection('broadcast', this)"><i class="fas fa-bullhorn"></i> Broadcast</div>
        <div class="nav-link" onclick="showSection('settings', this)"><i class="fas fa-cog"></i> App Settings</div>
    </div>

    <div class="main-content">
        
        <div id="dashboard" class="section active">
            <div class="dashboard-header">Dashboard Overview</div>
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-icon bg-blue"><i class="fas fa-users"></i></div><div class="stat-info"><h4>Total Users</h4><div id="total-users">0</div></div></div>
                <div class="stat-card"><div class="stat-icon bg-orange"><i class="fas fa-hourglass-half"></i></div><div class="stat-info"><h4>Pending</h4><div id="pending-count">0</div></div></div>
                <div class="stat-card"><div class="stat-icon bg-purple"><i class="fas fa-chart-line"></i></div><div class="stat-info"><h4>Total Balance</h4><div id="total-balance">0.00</div></div></div>
            </div>
        </div>

        <div id="users" class="section">
            <div class="dashboard-header">Manage Users</div>
            <div class="list-container">
                <input type="text" id="userSearch" placeholder="በ ID ፈልግ..." onkeyup="searchUser()">
                <table>
                    <thead><tr><th>User ID</th><th>Balance</th><th>Action</th></tr></thead>
                    <tbody id="all-users-list"></tbody>
                </table>
            </div>
        </div>

        <div id="withdrawals" class="section">
            <div class="dashboard-header">Pending Withdrawals</div>
            <div class="list-container">
                <table>
                    <thead><tr><th>Name</th><th>Phone</th><th>Amount</th><th>Method</th><th>Action</th></tr></thead>
                    <tbody id="pending-list"></tbody>
                </table>
            </div>
        </div>

        <div id="broadcast" class="section">
            <div class="dashboard-header">Send Notification</div>
            <div class="list-container">
                <div class="form-group">
                    <label>የመልዕክት ርዕስ</label><input type="text" id="msg-title" placeholder="ርዕስ...">
                </div>
                <div class="form-group">
                    <label>መልዕክት</label><textarea id="msg-body" rows="4" placeholder="መልዕክቱን እዚህ ይጻፉ..."></textarea>
                </div>
                <button class="btn" onclick="sendBroadcast()">መልዕክት ላክ (Broadcast)</button>
            </div>
        </div>

        <div id="settings" class="section">
            <div class="dashboard-header">App Settings</div>
            <div class="list-container">
                <div class="form-group">
                    <label>የእለታዊ ክፍያ ገደብ (Daily Limit)</label>
                    <input type="number" id="setting-limit" value="300">
                </div>
                <button class="btn" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>

    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCg7-ixJaGiJlpi6qav1dTQUmr3K7Ccrpo",
            authDomain: "ethiopia-ads-earn.firebaseapp.com",
            databaseURL: "https://ethiopia-ads-earn-default-rtdb.firebaseio.com",
            projectId: "ethiopia-ads-earn",
            storageBucket: "ethiopia-ads-earn.firebasestorage.app",
            messagingSenderId: "428629596077",
            appId: "1:428629596077:web:67e7227814bd60cc413324"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function showSection(id, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        // Dashboard & Users Sync
        db.ref('users').on('value', (snap) => {
            const data = snap.val();
            let totalUsers = 0; let totalBal = 0;
            const userTable = document.getElementById('all-users-list');
            userTable.innerHTML = "";

            if(data) {
                Object.keys(data).forEach(uid => {
                    totalUsers++;
                    totalBal += data[uid].balance || 0;
                    userTable.innerHTML += `<tr><td>${uid}</td><td>${data[uid].balance.toFixed(2)} ETB</td>
                    <td><button onclick="editUser('${uid}')">Edit</button></td></tr>`;
                });
            }
            document.getElementById('total-users').innerText = totalUsers;
            document.getElementById('total-balance').innerText = totalBal.toFixed(2);
        });

        // Withdrawals Sync
        db.ref('withdraw_requests').on('value', (snap) => {
            const reqs = snap.val();
            const list = document.getElementById('pending-list');
            list.innerHTML = "";
            let count = 0;
            if(reqs) {
                Object.keys(reqs).forEach(key => {
                    count++;
                    const r = reqs[key];
                    list.innerHTML += `<tr><td>${r.name}</td><td>${r.phone || r.acc}</td><td>${r.amount} ETB</td><td>${r.method}</td>
                    <td><button class="btn" style="background:#28a745" onclick="approve('${key}')">Approve</button></td></tr>`;
                });
            }
            document.getElementById('pending-count').innerText = count;
        });

        function approve(key) {
            if(confirm("ክፍያውን አጽድቀዋል?")) db.ref('withdraw_requests/' + key).remove();
        }

        function sendBroadcast() {
            const title = document.getElementById('msg-title').value;
            const body = document.getElementById('msg-body').value;
            if(!title || !body) return alert("እባክህ ባዶ ቦታዎችን ሙላ!");
            db.ref('notifications').push({ title, body, time: Date.now() })
            .then(() => { alert("መልዕክቱ ተልኳል!"); document.getElementById('msg-title').value = ""; document.getElementById('msg-body').value = ""; });
        }

        function saveSettings() {
            const limit = document.getElementById('setting-limit').value;
            db.ref('system/dailyLimit').set(parseInt(limit)).then(() => alert("ተቀምጧል!"));
        }

        function editUser(uid) {
            let newBal = prompt("አዲሱን ባላንስ ያስገቡ:");
            if(newBal) db.ref('users/' + uid).update({ balance: parseFloat(newBal) });
        }
    </script>
</body>
</html>
